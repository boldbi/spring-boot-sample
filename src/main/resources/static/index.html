<!DOCTYPE HTML>
<html>
<head> 
    <title>Bold BI</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsrender/1.0.0-beta/jsrender.min.js"></script> -->
    <script type="text/javascript" src="https://cdn.boldbi.com/embedded-sdk/v6.1.8/boldbi-embed.js"></script>    
    <style>
        #error-message{
            display: none;
            color: red;
            text-align: center;
            font-size: 20px;
            margin-top: 300px
        }
    </style>
</head>
<body onload="renderDashboard()"> 
    <div id="viewer-section">
        <div id="dashboard"></div>
    </div>
    <div id="error-message" ></div>
</body>
<script>
    function renderDashboard() {
        fetch('/getDetails')
          .then(response => {
          if (response.ok) {
            return response.json();
          } else {
            throw new Error('Error fetching data');
          }
        })
         .then(data => {
                createDashboard(data)
            })
            .catch(error => {
                //console.error('Error fetching embedConfig:', error);
                embedConfigErrorDialog();
                <!-- message ="Error fetching embedconfig.json file";
                const errorMessageElement = document.getElementById('error-message');
                errorMessageElement.textContent = message;
                errorMessageElement.style.display = 'block';     -->
            });           
    }
    function createDashboard(data)
    {
        var dashboard = BoldBI.create({
            serverUrl: data.serverUrl + "/" + data.siteIdentifier,
            dashboardId: data.dashboardId,
            embedContainerId: "dashboard",
            embedType: BoldBI.EmbedType.Component,
            environment:data.environment,
            width: window.innerWidth + "px",
            height: window.innerHeight + "px",
            mode: BoldBI.Mode.View,
            expirationTime: 100000,
            authorizationServer: {
                url: "/AuthorizationServer" 
            }
        });

        dashboard.loadDashboard();
    }
    function embedConfigErrorDialog() {
        var targetContainer = $('<div id="custom_dialog"></div>');
        var dlgDiv = $('<div id="sample_dialog" ></div>');
        targetContainer.append(dlgDiv);
        $('body').append(targetContainer);
        var dialog = new window.ejs.popups.Dialog({
            header: 'Error Message',
            width: '500px',
            isModal: true,
            showCloseIcon: true,
            target: document.getElementById('custom_dialog'),
            content: '<div>To compile and runÂ the project, an embed config file needs to be required. Please use the <a href="https://help.boldbi.com/embedded-bi/site-administration/embed-settings/" target="_blank">URL</a> to obtain the JSON file from the Bold BI server.</div>'
        });
        dialog.appendTo('#sample_dialog');
        var dialogFooter = $('<div id="sample_dialog_footer"><button id="custom_ok_button"onclick="Cancel()">OK</button></div>')
        $('#sample_dialog').append(dialogFooter);
        $('.e-dlg-overlay').css('position', 'fixed');
    }
    
    function Cancel() {
        $("#custom_dialog").html('');
    }
</script>
</html>
